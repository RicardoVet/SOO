<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<h:head>
</h:head>
<h:body>
	<h:form prependId="false" id="formulario">
		<f:metadata>
			<f:viewAction action="#{compararArquivos.checkF5}" />
		</f:metadata>
		<p:growl id="msg"/>
		<p:dataTable var="nome" value="#{compararArquivos.nomes}"
		emptyMessage="Nenhum Arquivo"
			rowIndexVar="indice" scrollable="true" scrollHeight="250"
			widgetVar="Tabela" id="tabelaPrincipal">
			<f:facet name="header">
				<p:outputPanel>
					<h:outputText value="Tabela" />
				</p:outputPanel>
			</f:facet>
			<p:column headerText="Selecionar" width="90">
				<p:selectBooleanCheckbox style="margin-left:35px;">
					<p:ajax update="msg comparar concatenar"
						listener="#{compararArquivos.addIndice(nome)}" />
				</p:selectBooleanCheckbox>
			</p:column>
			<p:column headerText="Nome" id="nome">
				<h:outputText value="#{nome}" />
			</p:column>
			<p:column headerText="Visualizar" width="90">
				<p:commandLink action="#{compararArquivos.visualizar(nome)}"
					update="msg :formatado" ajax="true" oncomplete="PF('bib').show();"
					style="margin-left:20px;">
					<p:graphicImage url="/resources/imagens/comparar/visualizar.png" />
				</p:commandLink>
			</p:column>
			<p:column headerText="Download" width="90">
				<p:commandLink action="#{compararArquivos.download(nome)}"
					ajax="false" style="margin-left:20px;">
					<p:graphicImage url="/resources/imagens/comparar/Download.png" />
				</p:commandLink>
			</p:column>
			<p:column headerText="Editar" width="90">
				<p:commandLink actionListener="#{compararArquivos.editar(nome)}"
					update="edicao" ajax="true" oncomplete="PF('edit').show();"
					style="margin-left:20px;">
					<p:graphicImage url="/resources/imagens/comparar/editar.png" />
				</p:commandLink>
			</p:column>
			<p:column headerText="Apagar" width="90">
				<p:commandLink action="#{compararArquivos.apagar(nome)}" update="tabelaPrincipal comparar msg"
					ajax="true" style="margin-left:20px;">
					<p:graphicImage url="/resources/imagens/comparar/deletar.png" />
				</p:commandLink>
			</p:column>
		</p:dataTable>
		<p:commandButton id="comparar"
			actionListener="#{compararArquivos.comparar}" value="Comparar"
			disabled="#{(compararArquivos.indices.size() lt 2) or (compararArquivos.indices eq null) or(compararArquivos.indices.size() ge 3)}"
			oncomplete="PF('dlg1').show();"
			update="tabela3 tabela" />
		<p:commandButton id="concatenar" ajax="false"
			actionListener="#{compararArquivos.concatenar}" value="Concatenar"
			disabled="#{(compararArquivos.indices.size() lt 2) or (compararArquivos.indices eq null) or(compararArquivos.indices.size() ge 3)}" />
		<p:commandButton id="BibKey" ajax="true"
			actionListener="#{compararArquivos.gerarBibKey()}" value="BibKey"
			disabled="#{(compararArquivos.indices.size() lt 0) or (compararArquivos.indices eq null) or(compararArquivos.indices.size() ge 3)}" />
		<!-- <p:button value="Voltar" href="inicio.jsf"/>-->

		<p:dialog header="Comparação dos Arquivos" widgetVar="dlg1"
			position="center center" modal="true" maximizable="false"
			minimizable="true" hideEffect="explode" showEffect="slide"
			minWidth="800" minHeight="800" width="70%" height="450"
			resizable="false" id="tabela">
			<c:if test="#{compararArquivos.indices.size() ge 2}">
				<p:layout style="min-width:300px;min-height:300px;" onResize="true">
					<p:layoutUnit position="west" resizable="true" size="50%"
						style="height:70px;">
								<h:outputText value="#{fn:replace(compararArquivos.visualizarPorIndice(0),'\\n','&lt;br/&gt;')}" escape="false" style="font-size:12px;" />
					</p:layoutUnit>

					<p:layoutUnit position="center" size="0" minSize="0" maxSize="0"
						visible="false">
					</p:layoutUnit>

					<p:layoutUnit position="east" resizable="true" size="50%"
						style="height:70px;">
								<h:outputText value="#{fn:replace(compararArquivos.visualizarPorIndice(1),'\\n','&lt;br/&gt;')}" escape="false" style="font-size:12px;" />
					</p:layoutUnit>
				</p:layout>
			</c:if>
			<p:layout>
				<p:layoutUnit position="top"></p:layoutUnit>
				<p:layoutUnit position="center">
					<p:dataTable var="bib"
						value="#{compararArquivos.bibView1.atributos.entrySet()}"
						id="tabela3">
						<p:column headerText="referencias">
							<h:outputText value="#{bib.key}"
								style="color:red; font-size:14px; font-family:arial,fantasy;" />
						</p:column>
						<p:column headerText="valores">
							<h:outputText value="#{bib.value}"
								style="color:red; font-size:14px; font-family:arial,fantasy;" />
						</p:column>
					</p:dataTable>
				</p:layoutUnit>
			</p:layout>
		</p:dialog>
		<p:dialog widgetVar="bib" id="formatado" height="200" width="600"
			position="center" maximizable="true" minimizable="true">
			<h:outputText
				value="#{fn:replace(compararArquivos.saidaPadronizada,'\\n','&lt;br/&gt;')}"
				escape="false" style="font-size:16px;" />
		</p:dialog>
		
		<p:dialog widgetVar="edit" id="edicao" height="200" width="600"
			position="center" maximizable="true">
			<c:if test="#{compararArquivos.bibUpdate.size() ge 1}">
			<c:forEach var="indice" begin="0"
				end="#{compararArquivos.bibUpdate.size()-1}">
				<p:dataTable var="bib" editable="true" editMode="cell"
					rowIndexVar="index"
					value="#{compararArquivos.bibUpdate.get(indice).atributos.entrySet()}">
					<p:column headerText="referencias">
						<h:outputText value="#{bib.key}"
							style="font-size:14px; font-family:arial,fantasy;" />
					</p:column>
					<p:column headerText="valores">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{bib.value}"
									style="font-size:14px; font-family:arial,fantasy;" />
							</f:facet>
							<f:facet name="input">
								<h:inputText
									value="#{compararArquivos.bibUpdate.get(indice).atributos[bib.key]}"
									style="font-size:14px; font-family:arial,fantasy;" />
							</f:facet>
						</p:cellEditor>
					</p:column>
				</p:dataTable>
			</c:forEach>
			</c:if>
		</p:dialog>
	</h:form>
	<ui:include src="dock.xhtml"></ui:include>
</h:body>
</html>
