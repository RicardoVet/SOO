<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<style>
		.ui-datatable .ui-column-filter {
			display: none;
			width: 100px;
			margin: auto;
		}
	</style>
</h:head>
<h:body>
	<h:form prependId="false">
	<f:metadata>
   <f:viewAction action="#{compararArquivos.checkF5}" onPostBack="true"/>
</f:metadata>
		<p:growl id="msg" />
		<p:dataTable var="nome" value="#{compararArquivos.nomes}"
			rowIndexVar="indice" rows="3" paginator="true"
			paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
			rowsPerPageTemplate="1,2,3" widgetVar="Tabela" id="tabelaPrincipal"
			filteredValue="#{compararArquivos.filteredNomes}">
			<f:facet name="header">
				<p:outputPanel>
					<h:outputText value="Buscar:" />
					<h:inputText id="globalFilter" onkeyup="PF('Tabela').filter()" />
				</p:outputPanel>
			</f:facet>
			<p:column headerText="Selecionar" width="90">
				<p:selectBooleanCheckbox style="margin-left:35px;">
					<p:ajax update="msg :comparar"
						listener="#{compararArquivos.addIndice(nome)}" />
				</p:selectBooleanCheckbox>
			</p:column>
			<p:column headerText="Nome" filterBy="#{nome}" id="nome">
					 <h:outputText value="#{nome}"/>
			</p:column>
			<p:column headerText="Visualizar" width="90">
				<p:commandLink action="#{compararArquivos.visualizar(nome)}" update="msg :formatado"
					ajax="true"
					oncomplete="PF('bib').show();"
					style="margin-left:20px;">
					<p:graphicImage url="/resources/imagens/comparar/visualizar.png" />
				</p:commandLink>
			</p:column>
			<p:column headerText="Download" width="90">
				<p:commandLink action="#{compararArquivos.download(nome)}"
					ajax="false"
					style="margin-left:20px;">
					<p:graphicImage url="/resources/imagens/comparar/Download.png" />
				</p:commandLink>
			</p:column>
			<p:column headerText="Editar" width="90">
				<p:commandLink action="#{compararArquivos.editar}" update="msg"
					ajax="true"
					style="margin-left:20px;">
					<p:graphicImage url="/resources/imagens/comparar/editar.png" />
				</p:commandLink>
			</p:column>
			<p:column headerText="Apagar" width="90">
				<p:commandLink action="#{compararArquivos.apagar}" update="msg"
					ajax="true"
					style="margin-left:20px;">
					<p:graphicImage url="/resources/imagens/comparar/deletar.png" />
				</p:commandLink>
			</p:column>
		</p:dataTable>
		<p:commandButton id="comparar"
			actionListener="#{compararArquivos.comparar}"
			value="Comparar"
			disabled="#{(compararArquivos.indices.size() lt 2) or (compararArquivos.indices eq null)}"
			oncomplete="PF('dlg1').show();" update="tabela1 :tabela2" />
		<!-- <p:button value="Voltar" href="inicio.jsf"/>-->
		<p:dialog header="Comparação dos Arquivos" widgetVar="dlg1"
			position="center center" modal="true" maximizable="false"
			minimizable="true" hideEffect="explode" showEffect="slide"
			minWidth="800" minHeight="800" width="70%" height="350"
			resizable="false">
			<p:layout style="min-width:300px;min-height:300px;" onResize="true">
				<p:layoutUnit position="west" resizable="true" size="50%"
					style="height:70px;">
					<p:dataTable value="#{compararArquivos.arquivos.get(0).get(0).atributos.entrySet()}" var="bib" id="tabela1">
						<p:column headerText="labels">
							<h:outputText value="#{bib.key}" />
						</p:column>
						<p:column headerText="valores">
							<h:outputText value="#{bib.value}" />
						</p:column>
					</p:dataTable>
				</p:layoutUnit>

				<p:layoutUnit position="center" size="0" minSize="0" maxSize="0"
					visible="false">
				</p:layoutUnit>

				<p:layoutUnit position="east" resizable="true" size="50%">
				<p:dataTable id="tabela2">
						
					</p:dataTable>
				</p:layoutUnit>
			</p:layout>
		</p:dialog>
		<p:dialog widgetVar="bib" id="formatado" height="200" width="600" position="center" maximizable="true" minimizable="true">
			<h:outputText value="#{fn:replace(compararArquivos.saidaPadronizada,'\\n','&lt;br/&gt;')}" escape="false" />
		</p:dialog>
	</h:form>
	<p:dock>
		<p:menuitem value="Cadastrar"
			icon="/resources/imagens/mesa/cadastrar.png" url="cadastrar.jsf"
			ajax="false" />
		<p:menuitem value="Upload" icon="/resources/imagens/mesa/upload.png"
			url="index.jsf" ajax="false" />
		<p:menuitem value="Cover Flow"
			icon="/resources/imagens/mesa/cover-flow.png" url="contentFlow.jsf" />
		<p:menuitem value="Comparar"
			icon="/resources/imagens/mesa/comparar.png" url="comparar.jsf" />
		<p:menuitem value="Lixeira" icon="/resources/imagens/mesa/lixo.png"
			url="#" />
	</p:dock>
</h:body>
</html>
